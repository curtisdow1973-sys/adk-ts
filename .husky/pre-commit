#!/bin/sh
# ğŸš¦ Pre-commit hook (temporary check)

echo "ğŸ” Detecting changed packages against origin/main..."

CHANGED=$(pnpm turbo run lint --filter=...[origin/main] --dry-run=json | \
  grep -o '"package":"[^"]*"' | awk -F '"' '{print $4}' | sort -u)

if [ -z "$CHANGED" ]; then
  echo "âœ… No affected packages. Skipping checks."
  exit 0
fi

echo "ğŸ“¦ Changed packages:"
echo "$CHANGED"

if echo "$CHANGED" | grep -qE '^packages/'; then
  echo "ğŸ§ª Packages changed â†’ Running Biome + Tests..."
  pnpm format && pnpm lint && pnpm test
else
  echo "ğŸ“„ Apps changed â†’ Running Biome only..."
  pnpm format && pnpm lint
fi
