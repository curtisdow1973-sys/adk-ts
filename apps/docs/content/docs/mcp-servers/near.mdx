---
title: MCP NEAR Agents
description: NEAR Protocol blockchain integration with AI-driven event processing
---

import { Callout } from 'fumadocs-ui/components/callout';

**Package**: [`@iqai/mcp-near`](https://www.npmjs.com/package/@iqai/mcp-near-agent)
**Purpose**: NEAR Protocol blockchain integration with AI-driven event processing

## Key Features

- âœ… Execute contract methods and transactions on NEAR blockchain
- âœ… Listen to and respond to contract events with AI processing
- âœ… View contract data and account information
- âœ… Handle custom logic through intelligent event listeners
- âœ… Compatible with any MCP client

## Available Tools

### `watch_near_event`

Start watching for specific events on a NEAR contract:

```typescript
{
  eventName: "run_agent",           // Event to watch for
  contractId: "contract.testnet",   // Contract to monitor
  responseMethodName: "agent_response", // Method to call with AI response
  cronExpression: "*/10 * * * * *"  // Optional: polling frequency
}
```

### `stop_watching_near_event`

Stop watching for specific events:

```typescript
{
  contractId: "contract.testnet",
  eventName: "run_agent"
}
```

### `list_watched_near_events`

List all currently watched events and statistics:

```typescript
{
  includeStats: true; // Optional: include performance statistics
}
```

## AI-Driven Event Processing Workflow

<Callout type="info" title="AI in the Loop">
The server enables an "AI in the loop" workflow for smart contract interactions.
</Callout>

The server enables an "AI in the loop" workflow:

1. ğŸ”— Smart contract transaction triggers an event and pauses execution
2. ğŸ¤– MCP server detects the event and requests AI processing from the client
3. ğŸ§  AI client processes the event data and provides intelligent response
4. â†©ï¸ Server sends AI response back to blockchain via transaction
5. âœ… Original smart contract resumes with the AI-provided data

## Event Processing Flow

When a blockchain event is detected:

1. ğŸ“¡ **Event Detection**: Server monitors blockchain for specified events
2. ğŸ¤– **AI Request**: Server requests sampling from MCP client with event data
3. ğŸ§  **AI Processing**: Client processes event and returns intelligent response
4. ğŸ“¤ **Blockchain Response**: Server sends AI response back to contract
5. ğŸ“Š **Statistics**: Performance metrics are tracked and available

## Environment Variables

| Variable          | Description                                                            |
| ----------------- | ---------------------------------------------------------------------- |
| `ACCOUNT_ID`      | Your NEAR account ID for authentication                                |
| `ACCOUNT_KEY`     | Private key for your NEAR account (ed25519: or secp256k1: format)      |
| `NEAR_NETWORK_ID` | NEAR network ("mainnet", "testnet", "betanet") - defaults to "mainnet" |
| `NEAR_NODE_URL`   | Custom NEAR RPC endpoint (optional)                                    |
| `NEAR_GAS_LIMIT`  | Gas limit for transactions (optional)                                  |

## Configuration Example

```json
{
  "mcpServers": {
    "near-server": {
      "command": "pnpm",
      "args": ["dlx", "@iqai/mcp-near"],
      "env": {
        "ACCOUNT_ID": "your-account.testnet",
        "ACCOUNT_KEY": "ed25519:your_private_key_here",
        "NEAR_NETWORK_ID": "testnet"
      }
    }
  }
}
```

## Usage Examples

1. **Start the MCP server** with your client
2. **Watch for events** using the MCP tool:
   ```
   Use watch_near_event with:
   - eventName: "price_request"
   - contractId: "oracle.testnet"
   - responseMethodName: "price_response"
   ```
3. **AI processes events automatically** when they occur on the blockchain
4. **Monitor with** `list_watched_near_events` to see status and statistics

## Response Format

The server provides structured responses:

- âœ” **Success/failure status** with detailed messages
- ğŸ”— **Subscription IDs** for tracking active watchers
- ğŸ“ˆ **Performance statistics** (success rates, processing times)
- ğŸ¯ **Event details** (contract, event type, timestamps)
- ğŸ’¡ **Helpful guidance** and troubleshooting tips

## Error Handling

The server handles common NEAR-related errors:

- ğŸš¨ **Invalid contract calls** or method names
- ğŸ’¸ **Insufficient account balance** for transactions
- ğŸ”‘ **Authentication issues** with account credentials
- ğŸŒ **Network connectivity problems** with NEAR RPC
- ğŸš« **Contract execution errors** returned by smart contracts
- â±ï¸ **Timeout handling** for long-running operations